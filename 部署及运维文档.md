# 面向高校学生的多模态智能模拟面试评测智能体 - 部署及运维文档

**项目名称**: 面向高校学生的多模态智能模拟面试评测智能体
**开发者**: @星梦游Xmy
**开发时间**: 2025年7月
**文档版本**: v1.0
**最后更新**: 2025年7月23日

> 本文档由@星梦游Xmy于2025年7月独立开发，版权所有。  

---

## 1. 系统概述

本系统是一个基于Web技术的多模态智能面试评测平台，支持实时视频分析、情绪识别、语音处理和数据可视化。系统采用前端技术栈构建，支持五个典型岗位的面试场景评测。

### 1.1 系统架构
- **前端框架**: HTML5 + CSS3 + JavaScript (ES6+)
- **图表库**: ECharts 5.4.2, Chart.js 4.4.8
- **AI库**: face-api.js 1.7.12, TensorFlow.js 4.10.0
- **3D渲染**: Three.js 0.132.2
- **视频处理**: WebRTC API
- **部署方式**: 静态文件部署 + 后端API服务

### 1.2 支持的面试岗位
1. 软件工程师
2. 人工智能工程师
3. 物联网工程师
4. 大数据分析师
5. 运维测试师

### 1.3 系统组件关系
```
┌─────────────────────────────────────────────────────────────┐
│                    客户端 (Browser)                         │
├─────────────────────────────────────────────────────────────┤
│  面试大屏  │  可视化大屏  │  知识库  │  个人简历  │  分析报告  │
├─────────────────────────────────────────────────────────────┤
│                     网络通信 (HTTP/HTTPS)                    │
├─────────────────────────────────────────────────────────────┤
│                    服务端 (Server)                          │
├─────────────────────────────────────────────────────────────┤
│  API服务  │  数据处理  │  模型推理  │  数据库  │  文件存储  │
└─────────────────────────────────────────────────────────────┘
```

## 2. 环境要求

### 2.1 服务器环境
- **操作系统**: Linux (Ubuntu 20.04+/CentOS 8+) / Windows Server 2019+ / macOS 12+
- **Web服务器**: Nginx 1.20+ / Apache 2.4.48+ / IIS 10+
- **CPU**: 4核及以上
- **存储空间**: 最少2GB（包含模型文件和视频资源），建议4GB+
- **内存**: 最少4GB RAM，建议8GB+
- **网络**: 支持HTTPS（摄像头权限要求），建议100Mbps带宽

### 2.2 客户端环境
- **浏览器**: Chrome 90+, Firefox 88+, Edge 90+, Safari 14+
- **设备**: 720p及以上分辨率摄像头、内置或外接麦克风
- **网络**: 宽带连接（建议10Mbps以上，上传速度2Mbps以上）
- **分辨率**: 最低1366x768，推荐1920x1080
- **操作系统**: Windows 10+, macOS 10.14+, Linux (Ubuntu 20.04+)

### 2.3 CDN依赖
```
- ECharts: https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js
- Face-API: https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.12/dist/face-api.js
- Three.js: https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js
- Chart.js: https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js
- Font Awesome: https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css
- Google Fonts: https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700
```

### 2.4 数据库要求
- **MongoDB**: 4.4+（推荐5.0+）
- **存储空间**: 最少5GB
- **连接池**: 建议设置为100-200个连接

### 2.5 安全要求
- 服务器需配置防火墙
- 建议使用SSL/TLS 1.3证书
- 定期更新系统和软件补丁
- 实施强密码策略
- 限制不必要的端口开放

## 3. 部署步骤

### 3.1 前端部署

#### 3.1.1 构建脚本
```bash
# 前端构建脚本
#!/bin/bash

# 设置环境变量
export NODE_ENV=production

echo "开始构建前端项目..."
# 安装依赖
npm install --production
if [ $? -ne 0 ]; then
  echo "依赖安装失败，请检查网络连接"
  exit 1
fi

# 构建项目
npm run build
if [ $? -ne 0 ]; then
  echo "项目构建失败，请检查代码错误"
  exit 1
fi

# 优化静态资源
echo "优化静态资源..."
# 压缩图片
find ./dist -type f -name "*.jpg" -exec jpegoptim --max=80 --strip-all {} \;
find ./dist -type f -name "*.png" -exec optipng -o2 {} \;

# 复制到部署目录
echo "复制到部署目录..."
rsync -avz --delete ./dist/ /var/www/ai-interview/dist/

# 设置权限
chown -R www-data:www-data /var/www/ai-interview/dist/
chmod -R 755 /var/www/ai-interview/dist/

echo "前端项目构建并部署成功!"
```

#### 3.1.2 Nginx配置
```nginx
# Nginx配置文件
server {
    listen 80;
    server_name ai-interview.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name ai-interview.example.com;

    # SSL配置
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256';
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    location / {
        root /var/www/ai-interview/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 60;
        proxy_send_timeout 60;
        proxy_read_timeout 60;
    }

    # 静态资源缓存
    location ~* \.(jpg|jpeg|png|gif|css|js|ico|svg|woff|woff2|ttf|eot)$ {
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }

    # 模型文件缓存
    location /models/ {
        expires 7d;
        add_header Cache-Control "public";
    }

    # 安全头
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
}
```

### 3.2 后端部署

#### 3.2.1 项目结构
```
backend/
├── app.py              # 应用入口
├── config.py           # 配置文件
├── requirements.txt    # 依赖列表
├── models/             # 数据模型
├── routes/             # 路由处理
├── services/           # 业务逻辑
├── utils/              # 工具函数
└── templates/          # 模板文件
```

#### 3.2.2 启动脚本
```bash
# 后端启动脚本
#!/bin/bash

# 设置环境变量
export FLASK_APP=app.py
export FLASK_ENV=production
export DATABASE_URL=mongodb://localhost:27017/ai_interview
export SECRET_KEY=your-secret-key
export MAX_WORKERS=4

echo "开始启动后端服务..."
# 安装依赖
pip install -r requirements.txt
if [ $? -ne 0 ]; then
  echo "依赖安装失败，请检查网络连接"
  exit 1
fi

# 数据库迁移
flask db upgrade

# 启动服务
gunicorn -w $MAX_WORKERS -b 0.0.0.0:5000 --access-logfile access.log --error-logfile error.log --timeout 120 app:app
echo "后端服务已启动!"
echo "访问日志: access.log"
echo "错误日志: error.log"
```

#### 3.2.3 示例配置文件
```python
# config.py
import os

class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'hard-to-guess-string'
    MONGODB_SETTINGS = {
        'db': 'ai_interview',
        'host': os.environ.get('DATABASE_URL') or 'mongodb://localhost:27017/ai_interview'
    }
    MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # 16MB
    ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif', 'pdf', 'doc', 'docx'}
    CORS_HEADERS = 'Content-Type'

class DevelopmentConfig(Config):
    DEBUG = True

class ProductionConfig(Config):
    DEBUG = False

config = {
    'development': DevelopmentConfig,
    'production': ProductionConfig,
    'default': DevelopmentConfig
}
```

#### 3.2.4 示例应用入口
```python
# app.py
from flask import Flask
from flask_cors import CORS
from flask_mongoengine import MongoEngine
from config import config

# 初始化扩展
db = MongoEngine()


def create_app(config_name='default'):
    app = Flask(__name__)
    app.config.from_object(config[config_name])

    # 初始化扩展
    db.init_app(app)
    CORS(app)

    # 注册蓝图
    from .routes.interview import interview_bp
    from .routes.user import user_bp
    from .routes.report import report_bp
    from .routes.knowledge import knowledge_bp

    app.register_blueprint(interview_bp, url_prefix='/api/interview')
    app.register_blueprint(user_bp, url_prefix='/api/user')
    app.register_blueprint(report_bp, url_prefix='/api/report')
    app.register_blueprint(knowledge_bp, url_prefix='/api/knowledge')

    return app

if __name__ == '__main__':
    app = create_app('development')
    app.run(host='0.0.0.0', port=5000)
```

#### 3.2.2 进程监控
```bash
# 进程监控脚本
#!/bin/bash

# 检查服务是否运行
check_service() {
    pgrep -f "flask run" > /dev/null
    return $?
}

# 启动服务
start_service() {
    echo "启动后端服务..."
    nohup flask run --host=0.0.0.0 --port=5000 > app.log 2>&1 &
    sleep 2
}

# 主逻辑
if check_service; then
    echo "后端服务已在运行"
else
    start_service
    if check_service; then
        echo "后端服务启动成功"
    else
        echo "后端服务启动失败"
    fi
fi
```

### 3.3 数据库部署

#### 3.3.1 MongoDB配置
```javascript
// MongoDB配置文件 (mongod.conf)
storage:
  dbPath: /var/lib/mongodb
  journal:
    enabled: true
  wiredTiger:
    engineConfig:
      cacheSizeGB: 2  # 根据实际内存调整，建议为系统内存的50%

systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log
  logRotate: reopen
  verbosity: 0

net:
  port: 27017
  bindIp: 127.0.0.1
  maxIncomingConnections: 1000

security:
  authorization: enabled

processManagement:
  fork: true
  pidFilePath: /var/run/mongodb/mongod.pid
```

#### 3.3.2 数据库初始化脚本
```javascript
// 数据库初始化脚本
// 连接到MongoDB
const { MongoClient } = require('mongodb');

// 配置参数
const config = {
  uri: 'mongodb://localhost:27017',
  dbName: 'ai_interview',
  adminUser: 'admin',
  adminPassword: 'secure-password-here', // 生产环境请使用强密码
  collections: ['interviews', 'users', 'reports', 'knowledge', 'feedback']
};

async function initDatabase() {
  const client = new MongoClient(config.uri);

  try {
    // 连接到数据库
    await client.connect();
    console.log('已连接到MongoDB');

    // 创建数据库
    const db = client.db(config.dbName);
    console.log(`已创建数据库: ${config.dbName}`);

    // 创建管理员用户
    await db.command({
      createUser: config.adminUser,
      pwd: config.adminPassword,
      roles: [{
        role: 'readWrite',
        db: config.dbName
      }]
    });
    console.log(`已创建用户: ${config.adminUser}`);

    // 创建集合
    for (const collection of config.collections) {
      await db.createCollection(collection);
      console.log(`已创建集合: ${collection}`);
    }

    // 创建索引以提高查询性能
    await db.collection('users').createIndex({ 'email': 1 }, { unique: true });
    await db.collection('interviews').createIndex({ 'userId': 1, 'timestamp': -1 });
    await db.collection('reports').createIndex({ 'sessionId': 1 }, { unique: true });
    console.log('已创建索引');

  } catch (error) {
    console.error('数据库初始化失败:', error);
  } finally {
    // 关闭连接
    await client.close();
  }
}

// 执行初始化
initDatabase();
```

#### 3.3.3 Docker部署配置
```yaml
version: '3.8'
services:
  web:
    build: .
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./cert:/etc/nginx/cert
      - ./media:/usr/share/nginx/html/media
    environment:
      - TZ=Asia/Shanghai
    restart: always
    depends_on:
      - db
      - redis

  db:
    image: mongo:5.0
    ports:
      - "27017:27017"
    volumes:
      - db_data:/data/db
      - ./mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=root-password
      - MONGO_INITDB_DATABASE=ai_interview
      - TZ=Asia/Shanghai
    restart: always
    command: --auth --wiredTigerCacheSizeGB 2

  redis:
    image: redis:6.2
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    environment:
      - TZ=Asia/Shanghai
    restart: always
    command: --save 60 1 --loglevel warning

volumes:
  db_data:
  redis_data:
```

#### 3.3.4 Docker初始化脚本
```javascript
// mongo-init.js
// 此脚本会在MongoDB容器启动时自动执行

// 连接到admin数据库
db = connect('mongodb://root:root-password@localhost:27017/admin');

// 创建用户和数据库
db.createUser({
  user: 'admin',
  pwd: 'secure-password-here',
  roles: [{
    role: 'readWrite',
    db: 'ai_interview'
  }]
});

// 切换到ai_interview数据库
db = connect('mongodb://admin:secure-password-here@localhost:27017/ai_interview');

// 创建集合
db.createCollection('interviews');
db.createCollection('users');
db.createCollection('reports');
db.createCollection('knowledge');
db.createCollection('feedback');

// 创建索引
db.users.createIndex({ 'email': 1 }, { unique: true });
db.interviews.createIndex({ 'userId': 1, 'timestamp': -1 });
db.reports.createIndex({ 'sessionId': 1 }, { unique: true });

print('MongoDB初始化完成');
```

### 3.2 Nginx配置示例
```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com;
    
    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;
    
    root /var/www/ai-interview;
    index index.html;
    
    # 启用gzip压缩
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    
    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # 视频文件特殊处理
    location ~* \.(mp4|webm|ogg)$ {
        expires 30d;
        add_header Cache-Control "public";
        add_header Accept-Ranges bytes;
    }
    
    # 模型文件缓存
    location /models/ {
        expires 7d;
        add_header Cache-Control "public";
    }
    
    # 安全头设置
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    
    # 支持摄像头权限
    add_header Permissions-Policy "camera=(), microphone=(), geolocation=()";
}

# HTTP重定向到HTTPS
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

### 3.3 Apache配置示例
```apache
<VirtualHost *:443>
    ServerName your-domain.com
    DocumentRoot /var/www/ai-interview
    
    SSLEngine on
    SSLCertificateFile /path/to/certificate.crt
    SSLCertificateKeyFile /path/to/private.key
    
    # 启用压缩
    LoadModule deflate_module modules/mod_deflate.so
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png|ico)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </Location>
    
    # 缓存设置
    <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
    </FilesMatch>
    
    # 安全头
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
</VirtualHost>
```

## 4. 配置说明

### 4.1 系统配置文件
主要配置位于以下文件：
- `interview/index/package.json` - 项目依赖配置
- `interview/index/js/main.js` - 主要业务逻辑配置
- `interview/index/js/face-detection.js` - 人脸检测参数配置
- `interview/index/js/config.js` - 全局配置文件
- `backend/config.py` - 后端服务配置

### 4.2 前端关键配置参数
```javascript
// 人脸检测配置
const DETECTION_PARAMS = {
  interval: 200,           // 检测间隔(毫秒)
  scoreThreshold: 0.5,     // 置信度阈值
  inputSize: 416,          // 输入尺寸
  maxFaces: 1,             // 最大检测人脸数
  boxColor: '#00d0ff',     // 边框颜色
  boxWidth: 2,             // 边框宽度
  showLandmarks: false,    // 是否显示特征点
  showDetectionBox: false  // 是否显示检测框
};

// 情绪映射配置
const EMOTIONS = {
  neutral: { name: '平静', color: '#64748b', weight: 1.0 },
  happy: { name: '愉快', color: '#22c55e', weight: 1.2 },
  sad: { name: '悲伤', color: '#64748b', weight: 0.8 },
  angry: { name: '愤怒', color: '#ef4444', weight: 0.6 },
  fearful: { name: '恐惧', color: '#a855f7', weight: 0.7 },
  disgusted: { name: '厌恶', color: '#8b5cf6', weight: 0.6 },
  surprised: { name: '惊讶', color: '#eab308', weight: 1.1 }
};

// 能力评估配置
const ASSESSMENT_CONFIG = {
  skills: [
    { name: '专业知识', weight: 0.25 },
    { name: '技能匹配', weight: 0.20 },
    { name: '语言表达', weight: 0.15 },
    { name: '逻辑思考', weight: 0.15 },
    { name: '创新思维', weight: 0.15 },
    { name: '应变抗压', weight: 0.10 }
  ],
  thresholds: {
    excellent: 85,
    good: 70,
    average: 50,
    poor: 0
  }
};
```

### 4.3 性能优化配置
```javascript
// 图表性能配置
const CHART_CONFIG = {
  animation: true,
  animationDuration: 1000,
  responsive: true,
  maintainAspectRatio: false,
  lazyLoad: true,
 渐进式渲染: true
};

// 视频处理配置
const VIDEO_CONFIG = {
  width: 640,
  height: 480,
  frameRate: 30,
  facingMode: 'user',
  enableConstraints: true,
  resizeMode: 'contain'
};

// 资源加载配置
const LOADING_CONFIG = {
  preloadModels: true,
  modelCacheDuration: 3600000,  // 1小时
  lazyLoadResources: true,
  resourceCacheSize: 50 * 1024 * 1024  // 50MB
};
```

### 4.4 后端配置参数
```python
# 后端配置示例 (config.py)
class ProductionConfig(Config):
    DEBUG = False
    TESTING = False
    MONGODB_SETTINGS = {
        'db': 'ai_interview',
        'host': os.environ.get('DATABASE_URL') or 'mongodb://localhost:27017/ai_interview',
        'connectTimeoutMS': 30000,
        'socketTimeoutMS': 30000,
        'maxPoolSize': 100
    }
    CACHE_TYPE = 'redis'
    CACHE_REDIS_URL = os.environ.get('REDIS_URL') or 'redis://localhost:6379/0'
    RATELIMIT_ENABLED = True
    RATELIMIT_STORAGE_URL = os.environ.get('REDIS_URL') or 'redis://localhost:6379/0'
    RATELIMIT_DEFAULT = '200 per hour'
    MAX_WORKERS = 4
    TIMEOUT = 120
```

## 5. 运维监控

### 5.1 日志监控
```bash
# Nginx访问日志
tail -f /var/log/nginx/access.log

# Nginx错误日志
tail -f /var/log/nginx/error.log

# 系统资源监控
htop
iostat -x 1
```

### 5.2 性能监控指标
- **页面加载时间**: < 3秒
- **首屏渲染时间**: < 2秒
- **JavaScript执行时间**: < 1秒
- **内存使用**: < 500MB
- **CPU使用率**: < 50%

### 5.3 监控脚本示例
```bash
#!/bin/bash
# 系统健康检查脚本

# 检查Web服务状态
if ! curl -f -s https://your-domain.com > /dev/null; then
    echo "网站无法访问" | mail -s "网站告警" admin@example.com
fi

# 检查磁盘空间
DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 80 ]; then
    echo "磁盘空间不足: ${DISK_USAGE}%" | mail -s "磁盘告警" admin@example.com
fi

# 检查内存使用
MEM_USAGE=$(free | grep Mem | awk '{printf("%.2f", $3/$2 * 100.0)}')
if (( $(echo "$MEM_USAGE > 80" | bc -l) )); then
    echo "内存使用过高: ${MEM_USAGE}%" | mail -s "内存告警" admin@example.com
fi
```

## 6. 故障排除

### 6.1 常见问题及解决方案

#### 6.1.1 摄像头无法访问
**问题**: 用户无法使用摄像头功能
**原因**: 
- 网站未使用HTTPS
- 用户拒绝了摄像头权限
- 浏览器不支持WebRTC

**解决方案**:
1. 确保网站使用HTTPS协议
2. 引导用户重新授权摄像头权限
3. 提示用户升级浏览器版本

#### 6.1.2 人脸检测模型加载失败
**问题**: face-api.js模型无法加载
**原因**:
- CDN网络问题
- 模型文件损坏
- 浏览器缓存问题

**解决方案**:
```javascript
// 添加模型加载重试机制
async function loadModelsWithRetry(maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      await faceapi.nets.tinyFaceDetector.loadFromUri('/models');
      await faceapi.nets.faceLandmark68Net.loadFromUri('/models');
      await faceapi.nets.faceRecognitionNet.loadFromUri('/models');
      await faceapi.nets.faceExpressionNet.loadFromUri('/models');
      return true;
    } catch (error) {
      console.warn(`模型加载失败，重试 ${i + 1}/${maxRetries}:`, error);
      if (i === maxRetries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }
}
```

#### 6.1.3 图表显示异常
**问题**: ECharts图表无法正常显示
**原因**:
- 容器尺寸问题
- 数据格式错误
- 主题配置问题

**解决方案**:
```javascript
// 图表自适应处理
function resizeCharts() {
  const charts = document.querySelectorAll('[id$="-chart"]');
  charts.forEach(chartElement => {
    const chartInstance = echarts.getInstanceByDom(chartElement);
    if (chartInstance) {
      chartInstance.resize();
    }
  });
}

// 监听窗口大小变化
window.addEventListener('resize', debounce(resizeCharts, 300));
```

### 6.2 性能问题排查

#### 6.2.1 页面加载缓慢
**排查步骤**:
1. 检查网络连接速度
2. 分析资源加载时间
3. 检查CDN可用性
4. 优化图片和视频资源

#### 6.2.2 内存泄漏
**排查方法**:
```javascript
// 内存监控
function monitorMemory() {
  if (performance.memory) {
    console.log('内存使用情况:', {
      used: Math.round(performance.memory.usedJSHeapSize / 1048576) + 'MB',
      total: Math.round(performance.memory.totalJSHeapSize / 1048576) + 'MB',
      limit: Math.round(performance.memory.jsHeapSizeLimit / 1048576) + 'MB'
    });
  }
}

// 定期检查内存使用
setInterval(monitorMemory, 30000);
```

## 7. 安全配置

### 7.1 HTTPS配置
```bash
# 使用Let's Encrypt获取免费SSL证书
certbot --nginx -d your-domain.com

# 自动续期
echo "0 12 * * * /usr/bin/certbot renew --quiet" | crontab -
```

### 7.2 安全头配置
```nginx
# 内容安全策略
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; media-src 'self' blob:; connect-src 'self' https:; frame-src 'none';";

# 防止点击劫持
add_header X-Frame-Options "DENY";

# 防止MIME类型嗅探
add_header X-Content-Type-Options "nosniff";

# XSS保护
add_header X-XSS-Protection "1; mode=block";
```

### 7.3 访问控制
```nginx
# 限制访问频率
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req zone=api burst=20 nodelay;

# 禁止访问敏感文件
location ~ /\. {
    deny all;
}

location ~ \.(md|json|log)$ {
    deny all;
}
```

## 8. 备份恢复

### 8.1 备份策略
```bash
#!/bin/bash
# 自动备份脚本

BACKUP_DIR="/backup/ai-interview"
SOURCE_DIR="/var/www/ai-interview"
DATE=$(date +%Y%m%d_%H%M%S)

# 创建备份目录
mkdir -p $BACKUP_DIR

# 压缩备份
tar -czf $BACKUP_DIR/ai-interview_$DATE.tar.gz -C $SOURCE_DIR .

# 保留最近30天的备份
find $BACKUP_DIR -name "ai-interview_*.tar.gz" -mtime +30 -delete

# 备份到远程服务器（可选）
# rsync -av $BACKUP_DIR/ user@backup-server:/backup/ai-interview/
```

### 8.2 恢复流程
```bash
#!/bin/bash
# 恢复脚本

BACKUP_FILE=$1
RESTORE_DIR="/var/www/ai-interview"

if [ -z "$BACKUP_FILE" ]; then
    echo "使用方法: $0 <备份文件路径>"
    exit 1
fi

# 停止Web服务
systemctl stop nginx

# 备份当前版本
mv $RESTORE_DIR $RESTORE_DIR.backup.$(date +%Y%m%d_%H%M%S)

# 创建目录
mkdir -p $RESTORE_DIR

# 解压恢复
tar -xzf $BACKUP_FILE -C $RESTORE_DIR

# 设置权限
chown -R www-data:www-data $RESTORE_DIR
chmod -R 755 $RESTORE_DIR

# 启动Web服务
systemctl start nginx

echo "恢复完成"
```

## 9. 维护计划

### 9.1 日常维护
- **每日**: 检查系统日志，监控性能指标
- **每周**: 更新安全补丁，清理临时文件
- **每月**: 备份验证，性能优化评估
- **每季度**: 安全审计，容量规划评估

### 9.2 版本更新流程
1. 在测试环境验证新版本
2. 备份当前生产环境
3. 部署新版本到生产环境
4. 验证功能正常性
5. 监控系统稳定性

---

**文档维护**: 本文档由@星梦游Xmy于2025年7月创建，请定期更新以保持与系统同步。
